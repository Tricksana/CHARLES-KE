# This workflow will run tests using node and then publish a package to GitHub Packages when a release is created
# For more information see: https://docs.github.com/en/actions/publishing-packages/publishing-nodejs-packages

name: Node.js Package

on:
  release:
    types: [created]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm ci
      - run: npm test

  publish-npm:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          registry-url: https://registry.npmjs.org/
      - run: npm ci
      - run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{eyJub2lzZUtleSI6eyJwcml2YXRlIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiT0pQMHVteEtDSWtCTHFKV01RSTZGR3JNcDAvYzROcEU5WUNyNkhhQ2hXcz0ifSwicHVibGljIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiOTFpdFY1SVpKOGRxc2djMFFlaUhKb2xEcUl3ZXBCMVNTVWJXMm8xMXBqRT0ifX0sInBhaXJpbmdFcGhlbWVyYWxLZXlQYWlyIjp7InByaXZhdGUiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJJR01icEdHMlFrY05GL3htQjBWUWNUUDFHM3BndEpTY1JWa3dsOVJ4UlcwPSJ9LCJwdWJsaWMiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiI1bE9IQkY1bnpJbm5LQW5XRXBuM3JQNTIzbjhTNCtIdWhmN0lRK1QyOTIwPSJ9fSwic2lnbmVkSWRlbnRpdHlLZXkiOnsicHJpdmF0ZSI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6IjZDYVllL0VaK0R3aGQ4MUlwdnFmclNyKzZ5QXp1UWVLeUVTZDgrS2pkRkE9In0sInB1YmxpYyI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6ImVLTEZGSG1ocHNwSWxac3lSYzV3TUowOW8ydVBvR3NCZ2o3QjhoeFlzd2c9In19LCJzaWduZWRQcmVLZXkiOnsia2V5UGFpciI6eyJwcml2YXRlIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiU0lQTUt4bThLYU54SHFpNTd5bk1lY2pMYXVNYjUvL0pSRjVFcHJQd3BHMD0ifSwicHVibGljIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiUExSUkgxb3kvZjNCOXIvempwZjIxaStrT3NsWCs3WWF1TzluaW5PMThUQT0ifX0sInNpZ25hdHVyZSI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6IkxmclNjSGN6dmNhN2wwSlArbVJiakkwYjl5Sis1VEJWN2tSWjRabjdhbXg4L1QyTUl2UkFxeVRjbmNRRC9zcmJGc1RqR2lvdEFIaEE2TzBYb2NFZkF3PT0ifSwia2V5SWQiOjF9LCJyZWdpc3RyYXRpb25JZCI6MTksImFkdlNlY3JldEtleSI6ImxOMVk0S2ZVSjVvSDM4WHRaQUJEeE9vckJPUmVWcCt2c3hEZnNYdmV1amc9IiwicHJvY2Vzc2VkSGlzdG9yeU1lc3NhZ2VzIjpbeyJrZXkiOnsicmVtb3RlSmlkIjoiMjU0MTE0MDAzMjI2QHMud2hhdHNhcHAubmV0IiwiZnJvbU1lIjp0cnVlLCJpZCI6IkU2NUVCRkM4QzIyNjVBNjc3QzQ4MEQ2NUJBMEY3MTUwIn0sIm1lc3NhZ2VUaW1lc3RhbXAiOjE3MzM5MTg1MDZ9XSwibmV4dFByZUtleUlkIjozMSwiZmlyc3RVbnVwbG9hZGVkUHJlS2V5SWQiOjMxLCJhY2NvdW50U3luY0NvdW50ZXIiOjEsImFjY291bnRTZXR0aW5ncyI6eyJ1bmFyY2hpdmVDaGF0cyI6ZmFsc2V9LCJkZXZpY2VJZCI6IjVOS0gyUURZVHdDd1dGUE9ad2drb2ciLCJwaG9uZUlkIjoiOWZjYzk2OTQtMmY0My00NzQxLThmOGQtMDUyZjdiYzNiNTQzIiwiaWRlbnRpdHlJZCI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6ImtSUEN3SkVZdy90MG55Y1VGT1d6NGFQS3NEMD0ifSwicmVnaXN0ZXJlZCI6dHJ1ZSwiYmFja3VwVG9rZW4iOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJnM2FBa1pzYlRmdEtsaWc1QTlPdU43dHBYWlE9In0sInJlZ2lzdHJhdGlvbiI6e30sInBhaXJpbmdDb2RlIjoiSzVXOVpMTUYiLCJtZSI6eyJpZCI6IjI1NDExNDAwMzIyNjoxQHMud2hhdHNhcHAubmV0IiwibmFtZSI6Ik1hc2gifSwiYWNjb3VudCI6eyJkZXRhaWxzIjoiQ016MG9lY0JFSm4rNWJvR0dBRWdBQ2dBIiwiYWNjb3VudFNpZ25hdHVyZUtleSI6IlBMU1hCR01tYjBvY3RsU2kxeHRNaTFTeVNJOS8rNjBTRllmTWQ3ZlpDbVk9IiwiYWNjb3VudFNpZ25hdHVyZSI6IkJ6Q2lBb1hJcjZZdTNJMDc0RnQreWJoUTRTQTdZV3pCMWVYNlJ0cW5oSHdEUEFGRFNlRnhnNHF1Q1N3eFk1a1ZNR2NGZ0hHSVhodlhXWFhQa0lZRENBPT0iLCJkZXZpY2VTaWduYXR1cmUiOiJGUGM4K0V3dkpaQVExRitSYWgzTWVqTFlwQy9FMlJ2elhrRW1pQTh2cGgxNlhvcUNGVTFwc0hRdjR0dDI0TUN6TEkyTE1rTU93b0xjeFdrdXBtcjNBUT09In0sInNpZ25hbElkZW50aXRpZXMiOlt7ImlkZW50aWZpZXIiOnsibmFtZSI6IjI1NDExNDAwMzIyNjoxQHMud2hhdHNhcHAubmV0IiwiZGV2aWNlSWQiOjB9LCJpZGVudGlmaWVyS2V5Ijp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiQlR5MGx3UmpKbTlLSExaVW90Y2JUSXRVc2tpUGYvdXRFaFdIekhlMzJRcG0ifX1dLCJwbGF0Zm9ybSI6InNtYmEiLCJsYXN0QWNjb3VudFN5bmNUaW1lc3RhbXAiOjE3MzM5MTg1MDIsIm15QXBwU3RhdGVLZXlJZCI6IkFBQUFBQVhoIn0=}}
